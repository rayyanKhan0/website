<!DOCTYPE html>
<html>
<head>
  <title>UNO Multiplayer</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .hand { margin: 20px 0; }
    .card { display: inline-block; border: 1px solid #222; border-radius: 8px; padding: 10px; margin: 2px; cursor: pointer; min-width: 40px; text-align: center;}
    .red { background: #f77; }
    .green { background: #7f7; }
    .blue { background: #77f; }
    .yellow { background: #ff7; }
    .black { background: #333; color: #fff; }
  </style>
</head>
<body>
  <h2>UNO Multiplayer</h2>
  <div>
    Name: <input id="name" value="Player"><br>
    Room: <input id="room" value="test"><br>
    <button onclick="join()">Join Game</button>
  </div>
  <div id="players"></div>
  <div id="game" style="display:none;">
    <div>Top of Discard: <span id="top"></span></div>
    <div>Your Hand: <div class="hand" id="hand"></div></div>
    <button onclick="draw()">Draw Card</button>
    <div id="status"></div>
  </div>
  <script>
    let socket, myId, myHand = [], turn = 0, players = [];
    function join() {
      socket = io();
      const name = document.getElementById('name').value;
      const room = document.getElementById('room').value;
      socket.emit('join', { room, name });
      socket.on('players', nicks => {
        players = nicks;
        document.getElementById('players').innerHTML = '<b>Players:</b> ' + nicks.join(', ');
      });
      socket.on('start', ({ hands, discard, turn: t, players: pls }) => {
        myHand = hands[socket.id] || [];
        turn = t;
        players = pls;
        showGame(discard[discard.length - 1]);
      });
      socket.on('update', ({ hands, discard, turn: t }) => {
        myHand = hands[socket.id] || [];
        turn = t;
        showGame(discard[discard.length - 1]);
      });
      socket.on('win', name => {
        alert(name + " wins!");
        location.reload();
      });
    }
    function showGame(topCard) {
      document.getElementById('game').style.display = '';
      document.getElementById('top').innerHTML = renderCard(topCard);
      let handHtml = '';
      myHand.forEach((c, i) => {
        handHtml += `<span class="card ${c.color}" onclick="play(${i})">${c.color} ${c.value}</span>`;
      });
      document.getElementById('hand').innerHTML = handHtml;
      document.getElementById('status').innerText = "Turn: " + players[turn];
    }
    function play(idx) {
      const card = myHand[idx];
      let color = undefined;
      if (card.color === 'black') {
        color = prompt('Choose color: red, green, blue, yellow?', 'red');
      }
      socket.emit('play', { room: document.getElementById('room').value, card, color });
    }
    function draw() {
      socket.emit('draw', { room: document.getElementById('room').value });
    }
    function renderCard(card) {
      return `<span class="card ${card.color}">${card.color} ${card.value}${card.chosen ? ' (' + card.chosen + ')' : ''}</span>`;
    }
  </script>
</body>
</html>
